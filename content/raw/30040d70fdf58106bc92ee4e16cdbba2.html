<main id="page-blog-list-context-order-and-reasoning-drift-measuring-order-sensitivity-from-token-probabilities" class="super-content page__blog-list-context-order-and-reasoning-drift-measuring-order-sensitivity-from-token-probabilities parent-page__blog-list"><div class="super-navbar__breadcrumbs" style="position:absolute"><div class="notion-breadcrumb"><a id="block-8d6dfeef4c7f4d678b4899d2198877cb" href="/" class="notion-link notion-breadcrumb__item"><div class="notion-navbar__title notion-breadcrumb__title">Hi there!</div></a><span class="notion-breadcrumb__divider">/</span><a id="block-blog" href="/blog" class="notion-link notion-breadcrumb__item"><div class="notion-navbar__title notion-breadcrumb__title">Blog</div></a><span class="notion-breadcrumb__divider">/</span><a id="block-blog-list" href="/blog/list" class="notion-link notion-breadcrumb__item"><div class="notion-navbar__title notion-breadcrumb__title">List</div></a><span class="notion-breadcrumb__divider">/</span><a id="block-blog-list-context-order-and-reasoning-drift-measuring-order-sensitivity-from-token-probabilities" href="/blog/list/context-order-and-reasoning-drift-measuring-order-sensitivity-from-token-probabilities" class="notion-link notion-breadcrumb__item"><div class="notion-navbar__title notion-breadcrumb__title">Context Order and Reasoning Drift: Measuring Order Sensitivity from Token Probabilities</div></a></div></div><div class="notion-header page"><div class="notion-header__cover no-cover no-icon"></div><div class="notion-header__content max-width no-cover no-icon"><div class="notion-header__title-wrapper"><h1 class="notion-header__title">Context Order and Reasoning Drift: Measuring Order Sensitivity from Token Probabilities</h1></div></div></div><article id="block-blog-list-context-order-and-reasoning-drift-measuring-order-sensitivity-from-token-probabilities" class="notion-root max-width has-footer"><div class="notion-page__properties"><div class="notion-page__property"><div class="notion-page__property-name-wrapper"><div class="notion-page__property-icon-wrapper"><svg viewBox="0 0 16 16" style="width:16px;height:16px"><path d="M3.29688 14.4561H12.7031C14.1797 14.4561 14.9453 13.6904 14.9453 12.2344V3.91504C14.9453 2.45215 14.1797 1.69336 12.7031 1.69336H3.29688C1.82031 1.69336 1.05469 2.45215 1.05469 3.91504V12.2344C1.05469 13.6973 1.82031 14.4561 3.29688 14.4561ZM3.27637 13.1162C2.70898 13.1162 2.39453 12.8154 2.39453 12.2207V5.9043C2.39453 5.30273 2.70898 5.00879 3.27637 5.00879H12.71C13.2842 5.00879 13.6055 5.30273 13.6055 5.9043V12.2207C13.6055 12.8154 13.2842 13.1162 12.71 13.1162H3.27637ZM6.68066 7.38086H7.08398C7.33008 7.38086 7.41211 7.30566 7.41211 7.05957V6.66309C7.41211 6.41699 7.33008 6.3418 7.08398 6.3418H6.68066C6.44141 6.3418 6.35938 6.41699 6.35938 6.66309V7.05957C6.35938 7.30566 6.44141 7.38086 6.68066 7.38086ZM8.92285 7.38086H9.31934C9.56543 7.38086 9.64746 7.30566 9.64746 7.05957V6.66309C9.64746 6.41699 9.56543 6.3418 9.31934 6.3418H8.92285C8.67676 6.3418 8.59473 6.41699 8.59473 6.66309V7.05957C8.59473 7.30566 8.67676 7.38086 8.92285 7.38086ZM11.1582 7.38086H11.5547C11.8008 7.38086 11.8828 7.30566 11.8828 7.05957V6.66309C11.8828 6.41699 11.8008 6.3418 11.5547 6.3418H11.1582C10.9121 6.3418 10.8301 6.41699 10.8301 6.66309V7.05957C10.8301 7.30566 10.9121 7.38086 11.1582 7.38086ZM4.44531 9.58203H4.84863C5.09473 9.58203 5.17676 9.50684 5.17676 9.26074V8.86426C5.17676 8.61816 5.09473 8.54297 4.84863 8.54297H4.44531C4.20605 8.54297 4.12402 8.61816 4.12402 8.86426V9.26074C4.12402 9.50684 4.20605 9.58203 4.44531 9.58203ZM6.68066 9.58203H7.08398C7.33008 9.58203 7.41211 9.50684 7.41211 9.26074V8.86426C7.41211 8.61816 7.33008 8.54297 7.08398 8.54297H6.68066C6.44141 8.54297 6.35938 8.61816 6.35938 8.86426V9.26074C6.35938 9.50684 6.44141 9.58203 6.68066 9.58203ZM8.92285 9.58203H9.31934C9.56543 9.58203 9.64746 9.50684 9.64746 9.26074V8.86426C9.64746 8.61816 9.56543 8.54297 9.31934 8.54297H8.92285C8.67676 8.54297 8.59473 8.61816 8.59473 8.86426V9.26074C8.59473 9.50684 8.67676 9.58203 8.92285 9.58203ZM11.1582 9.58203H11.5547C11.8008 9.58203 11.8828 9.50684 11.8828 9.26074V8.86426C11.8828 8.61816 11.8008 8.54297 11.5547 8.54297H11.1582C10.9121 8.54297 10.8301 8.61816 10.8301 8.86426V9.26074C10.8301 9.50684 10.9121 9.58203 11.1582 9.58203ZM4.44531 11.7832H4.84863C5.09473 11.7832 5.17676 11.708 5.17676 11.4619V11.0654C5.17676 10.8193 5.09473 10.7441 4.84863 10.7441H4.44531C4.20605 10.7441 4.12402 10.8193 4.12402 11.0654V11.4619C4.12402 11.708 4.20605 11.7832 4.44531 11.7832ZM6.68066 11.7832H7.08398C7.33008 11.7832 7.41211 11.708 7.41211 11.4619V11.0654C7.41211 10.8193 7.33008 10.7441 7.08398 10.7441H6.68066C6.44141 10.7441 6.35938 10.8193 6.35938 11.0654V11.4619C6.35938 11.708 6.44141 11.7832 6.68066 11.7832ZM8.92285 11.7832H9.31934C9.56543 11.7832 9.64746 11.708 9.64746 11.4619V11.0654C9.64746 10.8193 9.56543 10.7441 9.31934 10.7441H8.92285C8.67676 10.7441 8.59473 10.8193 8.59473 11.0654V11.4619C8.59473 11.708 8.67676 11.7832 8.92285 11.7832Z"></path></svg></div><div class="notion-page__property-name"><span>Date</span></div></div><div class="notion-property notion-property__date property-5d71516e notion-semantic-string"><span class="date">February 7, 2026</span></div></div><div class="notion-page__property"><div class="notion-page__property-name-wrapper"><div class="notion-page__property-icon-wrapper"><svg viewBox="0 0 16 16" style="width:16px;height:16px"><path d="M10.9536 7.90088C12.217 7.90088 13.2559 6.79468 13.2559 5.38525C13.2559 4.01514 12.2114 2.92017 10.9536 2.92017C9.70142 2.92017 8.65137 4.02637 8.65698 5.39087C8.6626 6.79468 9.69019 7.90088 10.9536 7.90088ZM4.4231 8.03003C5.52368 8.03003 6.42212 7.05859 6.42212 5.83447C6.42212 4.63843 5.51245 3.68945 4.4231 3.68945C3.33374 3.68945 2.41846 4.64966 2.41846 5.84009C2.42407 7.05859 3.32251 8.03003 4.4231 8.03003ZM1.37964 13.168H5.49561C4.87231 12.292 5.43384 10.6074 6.78711 9.51807C6.18628 9.14746 5.37769 8.87231 4.4231 8.87231C1.95239 8.87231 0.262207 10.6917 0.262207 12.1628C0.262207 12.7974 0.548584 13.168 1.37964 13.168ZM7.50024 13.168H14.407C15.4009 13.168 15.7322 12.8423 15.7322 12.2864C15.7322 10.8489 13.8679 8.88354 10.9536 8.88354C8.04492 8.88354 6.17505 10.8489 6.17505 12.2864C6.17505 12.8423 6.50635 13.168 7.50024 13.168Z"></path></svg></div><div class="notion-page__property-name"><span>Author</span></div></div><div class="notion-property notion-property__person property-5d51766e notion-semantic-string no-wrap"><span class="individual-with-image"><div class="individual-letter-avatar">J</div><span>Jinkun Chen</span></span></div></div><div id="block-root-divider" class="notion-divider"></div></div><p id="block-44c92929b8394f309c61295cc4304cdd" class="notion-text notion-text__content notion-semantic-string"><em>How the same evidence can yield different answers when you only change the order.</em></p><ul id="block-400e9fb45a7e4d49a9292d484b48014b" class="notion-table-of-contents color-gray"><li class="notion-table-of-contents__item"><a class="notion-link" href="#block-9689e02c5cea4a2984f245095a73b42a"><div class="notion-semantic-string" style="margin-inline-start: 0px;">The phenomenon: same chunks, different outcomes</div></a></li><li class="notion-table-of-contents__item"><a class="notion-link" href="#block-6cc4c1402f7d460ab80054c5874a72d2"><div class="notion-semantic-string" style="margin-inline-start: 0px;">What we can observe during decoding</div></a></li><li class="notion-table-of-contents__item"><a class="notion-link" href="#block-4ee87c4b956043c4a30e375f8537d129"><div class="notion-semantic-string" style="margin-inline-start: 0px;">A simple instability signal</div></a></li><li class="notion-table-of-contents__item"><a class="notion-link" href="#block-205d40204dbe49d6ae816884e7bc0bbd"><div class="notion-semantic-string" style="margin-inline-start: 0px;">Measuring order sensitivity</div></a></li><li class="notion-table-of-contents__item"><a class="notion-link" href="#block-e88143119d5c4f0dad517fde37ad68a7"><div class="notion-semantic-string" style="margin-inline-start: 0px;">What this diagnostic is and is not</div></a></li><li class="notion-table-of-contents__item"><a class="notion-link" href="#block-3f99c25ac5ba4912bf4ddd7e93dfe45c"><div class="notion-semantic-string" style="margin-inline-start: 0px;">Practical notes</div></a></li></ul><div id="block-220b3a118fad4081ad4c4b461b0d6991" class="notion-divider"></div><p id="block-eeaa19563ff34390ad0269029a781536" class="notion-text notion-text__content notion-semantic-string">People often treat retrieval order as a formatting detail.</p><p id="block-b67a22b80cd3475da831110c8dd9fcb8" class="notion-text notion-text__content notion-semantic-string">In practice, context order can change the early next token distributions, and that can push decoding into a different trajectory.</p><p id="block-96d7c80486d34ba0a3b5e124066714d4" class="notion-text notion-text__content notion-semantic-string">This post is about how to measure that sensitivity using only token probabilities.</p><span class="notion-heading__anchor" id="9689e02c5cea4a2984f245095a73b42a"></span><h2 id="block-9689e02c5cea4a2984f245095a73b42a" class="notion-heading notion-semantic-string">The phenomenon: same chunks, different outcomes</h2><p id="block-f176a91f721f429b8e1a7fac56a0da3a" class="notion-text notion-text__content notion-semantic-string">In many retrieval augmented setups, the model receives a question and a set of retrieved chunks.</p><p id="block-8f1e4cda316d4a2abfa12037a7b69523" class="notion-text notion-text__content notion-semantic-string">If you permute those chunks but keep everything else fixed, you often get different answers.</p><p id="block-ed06827f14224eb4b7f7b77b9f72798d" class="notion-text notion-text__content notion-semantic-string">There are two important points.</p><p id="block-9fd7cef2874b43df9e833cdef40ce4e1" class="notion-text notion-text__content notion-semantic-string">First, order effects are not rare edge cases.</p><p id="block-bf0606f15b334fe1a371275bc6a8ac0e" class="notion-text notion-text__content notion-semantic-string">They show up even with greedy decoding because the model still makes a sequence of locally optimal choices.</p><p id="block-e32efefe02664bbbaeb1a753210bc44e" class="notion-text notion-text__content notion-semantic-string">Second, the effect is process level.</p><p id="block-87b9d47720da4cdaa9409d98d4f782b6" class="notion-text notion-text__content notion-semantic-string">You can observe drift before the final answer diverges.</p><div id="block-e17020002f224d5b96e7c1deddaeb80b" class="notion-image page-width"><span data-full-size="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/dae501b0-b950-497b-ab99-1ff16d6e23ed/order_sensitivity_schematic_v2/public" data-lightbox-src="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/dae501b0-b950-497b-ab99-1ff16d6e23ed/order_sensitivity_schematic_v2/public" style="display:contents"><img alt="Figure 1. Same chunk set, different order. A small permutation can change early next token distributions, which can change the entire decoding trajectory." loading="lazy" width="1000" height="1000" decoding="async" data-nimg="1" style="color:transparent;height:auto" srcset="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/dae501b0-b950-497b-ab99-1ff16d6e23ed/order_sensitivity_schematic_v2/w=1920,quality=90,fit=scale-down 1x, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/dae501b0-b950-497b-ab99-1ff16d6e23ed/order_sensitivity_schematic_v2/w=1920,quality=90,fit=scale-down 2x" src="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/dae501b0-b950-497b-ab99-1ff16d6e23ed/order_sensitivity_schematic_v2/w=1920,quality=90,fit=scale-down"></span><figcaption class="notion-caption notion-semantic-string">Figure 1. Same chunk set, different order. A small permutation can change early next token distributions, which can change the entire decoding trajectory.</figcaption></div><div id="block-16a98766b3474cb181c9347498bb883d" class="notion-divider"></div><span class="notion-heading__anchor" id="6cc4c1402f7d460ab80054c5874a72d2"></span><h2 id="block-6cc4c1402f7d460ab80054c5874a72d2" class="notion-heading notion-semantic-string">What we can observe during decoding</h2><p id="block-7c79cebdb2fa48aa894fba794b99a2b1" class="notion-text notion-text__content notion-semantic-string">At each decoding step <code class="code">t</code>, an autoregressive model produces a next token distribution <code class="code">p_t(·)</code>.</p><p id="block-932cc442da4d4324bfeb2933dad6f47e" class="notion-text notion-text__content notion-semantic-string">Many APIs expose only top <code class="code">k</code> candidates with log probabilities.</p><p id="block-2dd43decd999452281adf29d1b894044" class="notion-text notion-text__content notion-semantic-string">That is enough.</p><p id="block-558527bc62ab403c83b667751d4c9934" class="notion-text notion-text__content notion-semantic-string">We can renormalize the logged support and compute lightweight signals from the resulting distribution.</p><p id="block-a5d686e848ce41f39fbc3f3f2da94aa7" class="notion-text notion-text__content notion-semantic-string">The key idea is to measure two things.</p><ol type="1" class="notion-numbered-list"><li id="block-ce792fe55edf462d824ae1ffdc7e53e8" class="notion-list-item notion-semantic-string">Uncertainty at a step.</li><li id="block-f6bdf00a59fa407f82ed35d89174c66a" class="notion-list-item notion-semantic-string">Distributional change from one step to the next.</li></ol><div id="block-f0f3668b4c294e16b89ff8f21338fdae" class="notion-image page-width"><span data-full-size="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/2db10e62-a7cf-429b-b87c-5ae90c4db2cb/order_sensitivity_pipeline_v2/public" data-lightbox-src="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/2db10e62-a7cf-429b-b87c-5ae90c4db2cb/order_sensitivity_pipeline_v2/public" style="display:contents"><img alt="Figure 2. A compact pipeline from logged top " loading="lazy" width="1000" height="1000" decoding="async" data-nimg="1" style="color:transparent;height:auto" srcset="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/2db10e62-a7cf-429b-b87c-5ae90c4db2cb/order_sensitivity_pipeline_v2/w=1920,quality=90,fit=scale-down 1x, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/2db10e62-a7cf-429b-b87c-5ae90c4db2cb/order_sensitivity_pipeline_v2/w=1920,quality=90,fit=scale-down 2x" src="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/2db10e62-a7cf-429b-b87c-5ae90c4db2cb/order_sensitivity_pipeline_v2/w=1920,quality=90,fit=scale-down"></span><figcaption class="notion-caption notion-semantic-string">Figure 2. A compact pipeline from logged top <code class="code">k</code> token probabilities to an instability score and summary statistics.</figcaption></div><div id="block-459a31c6110e4658bc70f07956660bb9" class="notion-divider"></div><span class="notion-heading__anchor" id="4ee87c4b956043c4a30e375f8537d129"></span><h2 id="block-4ee87c4b956043c4a30e375f8537d129" class="notion-heading notion-semantic-string">A simple instability signal</h2><p id="block-259c2d7eb2d84ebc9d28f987bf39befb" class="notion-text notion-text__content notion-semantic-string">Define an entropy term <code class="code">H_t</code> from <code class="code">p_t</code> and a Jensen Shannon divergence term <code class="code">D_t</code> between <code class="code">p_t</code> and <code class="code">p_{t-1}</code>.</p><p id="block-cac03be8e18e49c68ce7a8c07f212db0" class="notion-text notion-text__content notion-semantic-string">Then define an instability index</p><span id="block-f600d75ea4224fb9bf8918f7e4a96f5b" class="notion-equation notion-equation__block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>I</mi><mi>t</mi></msub><mo>=</mo><msub><mi>D</mi><mi>t</mi></msub><mo>+</mo><mspace linebreak="newline"></mspace><mi>l</mi><mi>a</mi><mi>m</mi><mi>b</mi><mi>d</mi><mi>a</mi><msub><mi>H</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">I_t = D_t + \\lambda H_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">amb</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></span><p id="block-f7bcefd2e8044aca8085ab025ade377e" class="notion-text notion-text__content notion-semantic-string">where <code class="code">lambda</code> is a mixing weight.</p><p id="block-4111db499e3e4f9b8ebc352eba2c6eb6" class="notion-text notion-text__content notion-semantic-string">I use <code class="code">lambda = 1</code> as a default.</p><p id="block-d9a5a148a9674b9ba13ec823f0ede0fb" class="notion-text notion-text__content notion-semantic-string">To summarize a trace, use a peak statistic.</p><ul class="notion-bulleted-list"><li id="block-2845272b54f547a7850a308680f1d07e" class="notion-list-item notion-semantic-string"><code class="code">S = max_t I_t</code></li></ul><p id="block-5865175432ed41e2953f6a71249aeefb" class="notion-text notion-text__content notion-semantic-string">For early diagnostics, use prefix windows.</p><ul class="notion-bulleted-list"><li id="block-293d412a14574c5783e107b9181c85fd" class="notion-list-item notion-semantic-string"><code class="code">S_w = max_{t &lt;= w} I_t</code></li></ul><p id="block-91d31d2f1f3145da94fbec6eb1cfeef0" class="notion-text notion-text__content notion-semantic-string">This is simple on purpose.</p><p id="block-8e698f74ae894dabb3e479e72ba76c58" class="notion-text notion-text__content notion-semantic-string">The goal is not a perfect theory of decoding.</p><p id="block-6e2b83118b9047b1bbf30d35103d2177" class="notion-text notion-text__content notion-semantic-string">The goal is a consistent metric you can compute across many runs.</p><div id="block-326eb4ebfb53448590b29a620a6b7e4a" class="notion-divider"></div><span class="notion-heading__anchor" id="205d40204dbe49d6ae816884e7bc0bbd"></span><h2 id="block-205d40204dbe49d6ae816884e7bc0bbd" class="notion-heading notion-semantic-string">Measuring order sensitivity</h2><p id="block-5ad1a05ed490497d8e7839b9917aac6a" class="notion-text notion-text__content notion-semantic-string">Now we can define a clean protocol.</p><ol type="1" class="notion-numbered-list"><li id="block-0a513fb353c6491cb2f510b53d833c3c" class="notion-list-item notion-semantic-string">Fix a question and its retrieved chunk set.</li><li id="block-fb4e155474b84184898e78f9b6eccc45" class="notion-list-item notion-semantic-string">Generate multiple permutations of the chunk order.</li><li id="block-9f4f3d43b2764559ae2aff715f61a9aa" class="notion-list-item notion-semantic-string">Decode with the same settings for each permutation and log top <code class="code">k</code> token probabilities.</li><li id="block-ad9fde230a884483887a3decf617644f" class="notion-list-item notion-semantic-string">Compute <code class="code">I_t</code>, then summarize each run by <code class="code">S</code> or <code class="code">S_w</code>.</li><li id="block-701eb39f87bf4de8929c855678399967" class="notion-list-item notion-semantic-string">Quantify sensitivity from variability across permutations.</li></ol><div id="block-011e206e56e843f1a0134b9b5d02cb61" class="notion-image page-width"><span data-full-size="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/94793c01-9bdd-40b8-a594-1e41b0386754/order_sensitivity_protocol/public" data-lightbox-src="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/94793c01-9bdd-40b8-a594-1e41b0386754/order_sensitivity_protocol/public" style="display:contents"><img alt="Figure 3. Protocol for measuring order sensitivity by varying only the chunk order and comparing drift diagnostics across permutations." loading="lazy" width="1000" height="1000" decoding="async" data-nimg="1" style="color:transparent;height:auto" srcset="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/94793c01-9bdd-40b8-a594-1e41b0386754/order_sensitivity_protocol/w=1920,quality=90,fit=scale-down 1x, https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/94793c01-9bdd-40b8-a594-1e41b0386754/order_sensitivity_protocol/w=1920,quality=90,fit=scale-down 2x" src="https://images.spr.so/cdn-cgi/imagedelivery/j42No7y-dcokJuNgXeA0ig/94793c01-9bdd-40b8-a594-1e41b0386754/order_sensitivity_protocol/w=1920,quality=90,fit=scale-down"></span><figcaption class="notion-caption notion-semantic-string">Figure 3. Protocol for measuring order sensitivity by varying only the chunk order and comparing drift diagnostics across permutations.</figcaption></div><p id="block-29607c2daa6d4c13b4b5e515fddc818d" class="notion-text notion-text__content notion-semantic-string">You can report sensitivity in several equivalent ways.</p><ul class="notion-bulleted-list"><li id="block-11591c9eeede4c6bb3188bb4c7a1d1e5" class="notion-list-item notion-semantic-string"><code class="code">Var(S | q, chunks)</code>.</li><li id="block-d74cce6d7bdc430bbabbdbba17375fda" class="notion-list-item notion-semantic-string">Mean pairwise <code class="code">|S(pi_a) - S(pi_b)|</code>.</li><li id="block-1767ac7c8ab348daa0466668864baa28" class="notion-list-item notion-semantic-string">The fraction of permutations that cross a chosen risk threshold.</li></ul><p id="block-dc56fc9fbfcf4fa9bc1c4cad6845481c" class="notion-text notion-text__content notion-semantic-string">If you also label runs as correct or wrong, you can test whether higher sensitivity correlates with a higher chance of failure.</p><div id="block-49e841058b0846e1a7250ec0472565cc" class="notion-divider"></div><span class="notion-heading__anchor" id="e88143119d5c4f0dad517fde37ad68a7"></span><h2 id="block-e88143119d5c4f0dad517fde37ad68a7" class="notion-heading notion-semantic-string">What this diagnostic is and is not</h2><p id="block-96ae1255c5dc4daf86795f79784e538b" class="notion-text notion-text__content notion-semantic-string">What it is.</p><ul class="notion-bulleted-list"><li id="block-7745f07b1d9b4d94a602ee80823fe5a3" class="notion-list-item notion-semantic-string">A way to measure how much the decoding path changes under context permutations.</li><li id="block-71fc828e8e9a40f4b2c4bcc888e2731e" class="notion-list-item notion-semantic-string">A method that works with logged token probabilities.</li><li id="block-7950b31157cb477489281c4d9c94b909" class="notion-list-item notion-semantic-string">A tool to compare retrieval and prompting strategies by process dynamics.</li></ul><p id="block-81adce2303374493a995a409aef8910a" class="notion-text notion-text__content notion-semantic-string">What it is not.</p><ul class="notion-bulleted-list"><li id="block-991bc4b5f8b54c10a82e73f55bf0ed0e" class="notion-list-item notion-semantic-string">Not an intervention.</li><li id="block-e204090ec06441d4a0d7a36740080d3f" class="notion-list-item notion-semantic-string">Not a claim that you can eliminate order effects with a single heuristic.</li></ul><div id="block-5d67238c74484e7683df12c5edb6ebb4" class="notion-divider"></div><span class="notion-heading__anchor" id="3f99c25ac5ba4912bf4ddd7e93dfe45c"></span><h2 id="block-3f99c25ac5ba4912bf4ddd7e93dfe45c" class="notion-heading notion-semantic-string">Practical notes</h2><p id="block-a94592799f1149d69337b065db24e233" class="notion-text notion-text__content notion-semantic-string">A few details matter in practice.</p><ol type="1" class="notion-numbered-list"><li id="block-89125798ea0e48dda0d6f171700d4c15" class="notion-list-item notion-semantic-string">Keep decoding settings fixed.</li><li id="block-49a82115fca8491eacef2398d24db479" class="notion-list-item notion-semantic-string">Keep the chunk set fixed.</li><li id="block-3b87f6bd03d24b9c9c3a4aaa8b8db585" class="notion-list-item notion-semantic-string">Use a fixed random seed for permutation sampling.</li><li id="block-3c5c6f4760604f858f993381790e8139" class="notion-list-item notion-semantic-string">Use the same stopping rules across runs.</li></ol><p id="block-ed90326b395b4ba5aa263e8b0680ae17" class="notion-text notion-text__content notion-semantic-string">If you have access to full vocabulary logits, compute entropy and divergence on the full distribution.</p><p id="block-c6b667b202164f748e4e277ddb90f860" class="notion-text notion-text__content notion-semantic-string">If you only have top <code class="code">k</code> logging, renormalize on the logged support and treat the metric as a consistent approximation.</p><div id="block-700e767702bf45bf9a5d568b6c697453" class="notion-divider"></div><div id="block-a8df6ed4a7094905a0d15382ac2bc7d9" class="notion-toggle closed"><div class="notion-toggle__summary"><div class="notion-toggle__trigger"><div class="notion-toggle__trigger_icon"><span>‣</span></div></div><span class="notion-semantic-string">Implementation sketch</span></div></div><div id="block-2ec4f8c037df47139c77afb31efcfcb0" class="notion-code no-wrap"><button class="notion-code__copy-button"><svg class="notion-icon notion-icon__copy" viewBox="0 0 14 16"><path d="M2.404 15.322h5.701c1.26 0 1.887-.662 1.887-1.927V12.38h1.154c1.254 0 1.91-.662 1.91-1.928V5.555c0-.774-.158-1.266-.626-1.74L9.512.837C9.066.387 8.545.21 7.865.21H5.463c-1.254 0-1.91.662-1.91 1.928v1.084H2.404c-1.254 0-1.91.668-1.91 1.933v8.239c0 1.265.656 1.927 1.91 1.927zm7.588-6.62c0-.792-.1-1.161-.592-1.665L6.225 3.814c-.452-.462-.844-.58-1.5-.591V2.215c0-.533.28-.832.843-.832h2.38v2.883c0 .726.386 1.113 1.107 1.113h2.83v4.998c0 .539-.276.832-.844.832H9.992V8.701zm-.79-4.29c-.206 0-.288-.088-.288-.287V1.594l2.771 2.818H9.201zM2.503 14.15c-.563 0-.844-.293-.844-.832V5.232c0-.539.281-.837.85-.837h1.91v3.187c0 .85.416 1.26 1.26 1.26h3.14v4.476c0 .54-.28.832-.843.832H2.504zM5.79 7.816c-.24 0-.346-.105-.346-.345V4.547l3.223 3.27H5.791z"></path></svg>Copy</button><!--$--><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Inputs: per step top k logprobs: logp[t] = {token: log_prob}</span>
<span class="token comment"># Output: instability strength S</span>

<span class="token keyword">def</span> <span class="token function">renormalize</span><span class="token punctuation">(</span>logp_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>
    probs <span class="token operator">=</span> <span class="token punctuation">{</span>tok<span class="token punctuation">:</span> math<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>lp<span class="token punctuation">)</span> <span class="token keyword">for</span> tok<span class="token punctuation">,</span> lp <span class="token keyword">in</span> logp_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    z <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>probs<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>tok<span class="token punctuation">:</span> p <span class="token operator">/</span> z <span class="token keyword">for</span> tok<span class="token punctuation">,</span> p <span class="token keyword">in</span> probs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">entropy</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token builtin">sum</span><span class="token punctuation">(</span>pi <span class="token operator">*</span> math<span class="token punctuation">.</span>log<span class="token punctuation">(</span>pi<span class="token punctuation">)</span> <span class="token keyword">for</span> pi <span class="token keyword">in</span> p<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> pi <span class="token operator">&gt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">jsd</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
    keys <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token builtin">set</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
    m <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">+</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> keys<span class="token punctuation">}</span>
    <span class="token keyword">def</span> <span class="token function">kl</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>ai <span class="token operator">*</span> math<span class="token punctuation">.</span>log<span class="token punctuation">(</span>ai <span class="token operator">/</span> b<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span> ai <span class="token keyword">in</span> a<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> ai <span class="token operator">&gt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0.5</span> <span class="token operator">*</span> kl<span class="token punctuation">(</span>p<span class="token punctuation">,</span> m<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.5</span> <span class="token operator">*</span> kl<span class="token punctuation">(</span>q<span class="token punctuation">,</span> m<span class="token punctuation">)</span>

p_prev <span class="token operator">=</span> <span class="token boolean">None</span>
I <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p_t <span class="token operator">=</span> renormalize<span class="token punctuation">(</span>logp<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span>
    H_t <span class="token operator">=</span> entropy<span class="token punctuation">(</span>p_t<span class="token punctuation">)</span>
    D_t <span class="token operator">=</span> <span class="token number">0.0</span> <span class="token keyword">if</span> p_prev <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> jsd<span class="token punctuation">(</span>p_t<span class="token punctuation">,</span> p_prev<span class="token punctuation">)</span>
    I<span class="token punctuation">.</span>append<span class="token punctuation">(</span>D_t <span class="token operator">+</span> <span class="token number">1.0</span> <span class="token operator">*</span> H_t<span class="token punctuation">)</span>
    p_prev <span class="token operator">=</span> p_t

S <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span></code></pre><!--/$--><figcaption class="notion-caption notion-semantic-string"></figcaption></div></article></main>